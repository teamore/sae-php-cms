{% extends "base.html" %}
{% block title %}Index{% endblock %}
{% block script %}
    <script>
        async function sendDeleteRequest(id, title = '') {
            if (confirm('Are you sure you want to delete '+(title?'"'+title+'"':'the post')+' (id #'+id+')?')) {
                console.log("delete request for id "+id);
                await fetch('/posts/'+id, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then((response)=>{
                    console.log(response.text());
                    window.location = '/';
                });
            }
        }
        function showPost(id, append = '') {
            location.href='/posts/'+id+(append ? "/" + append : '');
        }
    </script>
{% endblock %}
{% block content %}
    <table>
        <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Image</th>
            <th>Date</th>
            <th>Action</th>
        </tr>
        {% for result in results %}
            <tr>
                <td onclick="showPost({{result.id}})">{{result.title}}</td>
                <td onclick="showPost({{result.id}})">{{result.author}}</td>
                <td onclick="showPost({{result.id}})"><img src="/assets/uploads/{{result.media.0.thumb}}" width="100px"></td>
                <td onclick="showPost({{result.id}})">{{result.created_at}}</td>
                <td>
                    <button onclick="showPost({{result.id}})">show</button>
                    {% if (user and user.id == result.user) %}
                        <button onclick="showPost('edit/{{result.id}}')">edit</button>
                        <button onclick="sendDeleteRequest({{result.id}},'{{result.title}}');">kill</button>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        <tr>
            <td colspan="100%" onclick="location.href='/posts/edit';">
                <button onclick="location.href='/posts/edit';">add</button>
            </td>
        </tr>
    </table>
{% endblock %}
{% block appendix %}
    <button onclick="location.href='/';">back</button>
{% endblock %}
