{% extends "base.html" %}
{% block title %}Index{% endblock %}
{% block script %}
    <script>
        async function sendDeleteRequest(id, title = '') {
            if (confirm('Are you sure you want to delete '+(title?'"'+title+'"':'the post')+' (id #'+id+')?')) {
                console.log("delete request for id "+id);
                fetch('/', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({post_id: id})  //if you do not want to send any addional data,  replace the complete JSON.stringify(YOUR_ADDITIONAL_DATA) with null
                }).then(()=>{window.location = window.location.href;});
            }
        }
        function showPost(id, append = '') {
            location.href='?post_id='+id+append;
        }
    </script>
{% endblock %}
{% block content %}
    <table>
        <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Date</th>
            <th>Action</th>
        </tr>
        {% for result in results %}
            <tr>
                <td onclick="showPost({{result.id}})">{{result.title}}</td>
                <td onclick="showPost({{result.id}})">{{result.author}}</td>
                <td onclick="showPost({{result.id}})">{{result.created_at}}</td>
                <td>
                    <button onclick="showPost({{result.id}})">show</button>
                    <button onclick="showPost({{result.id}},'&action=edit')">edit</button>
                    <button onclick="sendDeleteRequest({{result.id}},'{{result.title}}');">kill</button>
                </td>
            </tr>
        {% endfor %}
        <tr>
            <td colspan="100%" onclick="location.href='?action=edit';">
                <button onclick="location.href='?action=edit';">add</button>
            </td>
        </tr>
    </table>
{% endblock %}
{% block appendix %}
    <button onclick="location.href='?';">back</button>
{% endblock %}
